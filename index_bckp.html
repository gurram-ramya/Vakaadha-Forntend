<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VAKAADHA</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
</head>
<body>
  <!-- HEADER -->
  <!-- <header class="navbar" data-aos="fade-down">
    <div class="logo"><img src="./Images/logo.jpg" alt="Logo"></div>
    <input type="checkbox" id="menu-toggle" />
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <nav class="nav-links">
      <a href="index.html"><i class="fas fa-house"></i></a>
      <a href="#"><i class="fas fa-heart"></i></a>
      <a href="cart.html"><i class="fas fa-shopping-cart"></i></a>
      <a href="profile.html"><i class="fas fa-user"></i></a>
    </nav>
  </header> -->
    <header class="navbar">
      <div class="logo"><img src="./Images/logo.jpeg (1).jpg" alt="VAKAADHA Logo"></div>
      <input type="checkbox" id="menu-toggle" />
      <label for="menu-toggle" class="menu-icon">&#9776;</label>
      <nav class="nav-links">
        <a href="./index.html"><i class="fas fa-house"></i></a>
        <a href="./wishlist.html"><i class="fas fa-heart"></i><span class="wishlist-count" id="wishlistCount">0</span></a>
        <a href="./cart.html"><i class="fas fa-shopping-cart"></i><span id="cartCount">0</span></a>
        <a href="./profile.html"><i class="fas fa-user"></i></a>
      </nav>
    </header>

  <!-- HERO IMAGE -->
  <section class="hero-image-section" data-aos="zoom-in">
    <video autoplay muted loop>
      <source src="./Images/vakaadhavideo.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </section>

  <!-- FEATURED PRODUCTS -->
  <section class="featured-products" data-aos="fade-up">
    <h2>Top Picks for You</h2>
    <div class="product-row" id="featuredProducts">
      <p>Loading products...</p>
    </div>
    <div class="more-btn-wrapper" data-aos="fade-up" data-aos-delay="300">
      <a href="collections.html" class="more-btn">View More T-Shirts →</a>
    </div>
  </section>

  <!-- About & Contact Button Section -->
  <section class="info-section" data-aos="fade-up">
    <div class="info-buttons">
      <div class="info-left">
        <h2>More About Us</h2>
        <div class="info-buttons horizontal-buttons">
          <button onclick="openModal('aboutModal')">About Us</button>
          <button onclick="openModal('contactModal')">Contact Us</button>
        </div>
      </div>
      <div class="info-right">
        <h2>Follow Us for More Updates</h2>
        <div class="social-icons">
          <a href="https://twitter.com" target="_blank"><i class="fab fa-twitter"></i></a>
          <a href="https://instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
          <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
          <a href="https://youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </div>
  </section>


  <!-- About Modal -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('aboutModal')">&times;</span>
      <h2>About VAKAADHA</h2>
      <p class="about-description">
        VAKAADHA represents the intersection of premium streetwear and cutting-edge technology. We believe fashion should be accessible, sustainable, and push the boundaries of what's possible. Our mission is to create clothing that not only looks exceptional but tells a story of innovation and craftsmanship.
      </p>

      <div class="about-highlights">
        <div class="highlight-card" data-aos="fade-up" data-aos-delay="100">
          <h3>Premium Quality</h3>
          <p>Crafted with the finest materials and attention to detail</p>
        </div>
        <div class="highlight-card" data-aos="fade-up" data-aos-delay="200">
          <h3>Global Reach</h3>
          <p>Shipping worldwide with local currency support</p>
        </div>
        <div class="highlight-card" data-aos="fade-up" data-aos-delay="300">
          <h3>Community Driven</h3>
          <p>Built by and for the streetwear community</p>
        </div>
        <div class="highlight-card" data-aos="fade-up" data-aos-delay="400">
          <h3>Innovation</h3>
          <p>Pushing boundaries in fashion and technology</p>
        </div>
      </div>
    </div>
  </div>


  <!-- Contact Modal -->
  <div id="contactModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('contactModal')">&times;</span>
      <h2>Get in Touch</h2>
      <p class="contact-description">
        Have questions about our products or need styling advice? We'd love to hear from you. Connect with our team and join our growing community of fashion enthusiasts.
      </p>

      <div class="contact-info">
        <div class="info-item" data-aos="fade-up" data-aos-delay="100">
          <i class="fas fa-envelope"></i>
          <p><a href="mailto:hello@vakaadha.com">hello@vakaadha.com</a></p>
        </div>
        <div class="info-item" data-aos="fade-up" data-aos-delay="200">
          <i class="fas fa-phone"></i>
          <p><a href="tel:+15551234567">+1 (555) 123-4567</a></p>
        </div>
        <div class="info-item" data-aos="fade-up" data-aos-delay="300">
          <i class="fas fa-map-marker-alt"></i>
          <p>New York, NY 10001</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS (Correct Order) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="auth.js"></script>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="script.js"></script>

  <script>
    AOS.init({ duration: 1000 });

    function increment(btn) {
      const count = btn.parentElement.querySelector(".qty-count");
      count.textContent = parseInt(count.textContent) + 1;
    }

    function decrement(btn) {
      const count = btn.parentElement.querySelector(".qty-count");
      const current = parseInt(count.textContent);
      if (current > 1) count.textContent = current - 1;
    }



    async function addToCart(skuId, btn) {
      const qty = parseInt(btn.closest(".product-info").querySelector(".qty-count").textContent);
      const user = firebase.auth().currentUser;

      if (!user) {
        alert("Please log in to add items.");
        return;
      }

      const payload = {
        sku_id: parseInt(skuId),
        quantity: qty,
        user_id: user.email  // ✅ Fix: Include user_id here
      };

      console.log("📦 Payload to /cart:", payload);

      const res = await fetch("/cart", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        alert("✅ Added to cart!");
      } else {
        const err = await res.json();
        console.error("❌ Add to cart failed:", err);
        alert("Error adding to cart: " + (err.error || "Unknown"));
      }
    }


    document.addEventListener("DOMContentLoaded", () => {
      fetch("/featured-products")
        .then(res => {
          if (!res.ok) throw new Error("API error");
          return res.json();
        })
        .then(products => {
          const container = document.getElementById("featuredProducts");
          if (!products.length) {
            container.innerHTML = "<p>No products found.</p>";
            return;
          }

          container.innerHTML = products.map((p, idx) => `
            <div class="product-card" data-aos="${idx % 2 === 0 ? 'fade-left' : 'fade-right'}" data-aos-delay="${100 + idx * 100}">
              <i class="fas fa-heart wishlist-icon" onclick="handleWishlist(${p.sku_id})"></i>
              <i class="fas fa-share-alt share-icon"></i>
              <div class="product-image">
                <img src="./Images/${p.image_name}" alt="${p.name}">
              </div>
              <div class="product-info">
                <h3>${p.name}</h3>
                <p>₹${p.price.toFixed(2)}</p>
                <div class="quantity-selector">
                  <button class="qty-btn" onclick="decrement(this)">−</button>
                  <span class="qty-count">1</span>
                  <button class="qty-btn" onclick="increment(this)">+</button>
                </div>
                <div class="btn-group side-by-side">
                  <button class="btn-cart" onclick="addToCart('${p.sku_id}', this)">Add to Cart</button>
                  <button class="btn-buy" onclick="buyNow('${p.sku_id}')">Buy Now</button>
                </div>
              </div>
            </div>
          `).join("");
        })
        .catch(err => {
          console.error("Product fetch error:", err);
          document.getElementById("featuredProducts").innerHTML = "<p>Error loading products.</p>";
        });
    });
  </script>
  <script>
    async function handleWishlist(productId) {
      const user = firebase.auth().currentUser;
      if (!user) {
        alert("Please log in first.");
        return;
      }

      const email = user.email;

      // Get current wishlist
      const res = await fetch(`/wishlist?user_id=${email}`);
      const items = await res.json();
      const alreadyInWishlist = items.some(item => item.product_id == productId);

      if (alreadyInWishlist) {
        await fetch(`/wishlist?user_id=${email}&product_id=${productId}`, {
          method: "DELETE"
        });
        alert("Removed from wishlist");
      } else {
        await fetch("/wishlist", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            user_id: email,
            product_id: productId
          })
        });
        alert("Added to wishlist");
      }

      updateWishlistCount(); // update count
      // optional: window.location.href = "wishlist.html";
    }
  </script>

  <!-- Firebase and auth setup scripts (should already be present) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="auth.js"></script>

  <!-- Your wishlist count script -->
  <script>
    async function updateWishlistCount() {
      const user = firebase.auth().currentUser;
      if (!user) return;
      const res = await fetch(`/wishlist?user_id=${user.email}`);
      const data = await res.json();

      const countSpan = document.getElementById("wishlistCount");
      if (countSpan) {
        countSpan.textContent = data.length;
      }
    }

    // ✅ Auto-update wishlist count when user logs in
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        updateWishlistCount();
      }
    });
  </script>

  <!-- Optional: any other script like AOS or main site logic -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="script.js"></script>
</body>
</html>
